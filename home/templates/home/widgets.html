<html>
  {% load static %}
<!-- <nav class="navbar navbar-expand-lg navbar-dark bg-success p-2">
     <a href="" class="navbar-brand text-uppercase border-light">Database Manager</a>
     <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navBar" >
        <span class="navbar-toggler-icon"></span>
      </button>
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <div class="collapse ml-200 navbar-collapse" id="navBar">
     <ul class="navbar-nav float-end">
       <li class="nav-item"><a href='#' class="nav-link active">Home</a></li>
       <li class="nav-item"><a href='#' class="nav-link">Products</a></li>
       <li class="nav-item"><a href='#' class="nav-link">Become seller</a></li>
       <li class="nav-item"><a href='#' class="nav-link">portfolio</a></li>
       <li class="nav-item"><a href='#' class="nav-link">Contact us</a></li>
       <li class="nav-item"><a href='#' class="nav-link">About us</a></li>
     </ul>
     <form action="" class="form-inline">
        <input type="search" placeholder="Search products " class="form-control">
    </form>
    
</div>

</nav> -->
<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" />

<div class="container">
  <div class="row pt-4 text-center">
    <h1>Database Managment system(students)</h1>
  </div>
  
      <form class="form-inline" onsubmit="search_chat()">
        {% csrf_token %}
        <input oninput="search_chat()" type="search" name="by_name" id="search_box" style="width: 100%;" class="form-control float-left" placeholder="Search by First Name. . ." > 
        <button type="submit" hidden id="by_name_search" >search</button>
      </form>
    
    
  <div class="row mt-2">
    <div class="col-6 alert alert-danger">
      <h1 class="alert alert-danger">Add Information</h1>
      <form method="post" id="form_id">
         {% csrf_token %}
         <input type="text" hidden id="id">
        <div class="form-group">
          <label for="fname">First Name</label>
          <input
            id="fname"
            class="form-control"
            type="text"
            placeholder="Your First Name"
          />
        </div>

        <div class="form-group">
          <label for="sname">Second Name</label>
          <input
            type="text"
            id="sname"
            placeholder="Your Second Name"
            class="form-control"
          />
        </div>
        <div class="form-group">
          <label for="Email">Email Adress</label>
          <input
            type="email"
            id="email"
            class="form-control"
            placeholder="Your Email Adres"
          />
        </div>
        <div class="form-group">
          <label for="marks">Total Marks</label>
          <input
          id="marks"
            type="number"
            class="form-control"
            placeholder="Marks of All subjects"
          />
        </div>

        <div class="form-group">
          <label for="marks">Course</label>
          <input
          id="course"
            type="text"
            class="form-control"
            placeholder="Course that you completed"
          />
        </div>

        <div class="form-group" id="buttons">
          <button type="submit" class="btn btn-primary" id="submitBtn">
            save
          </button>
        </div>
      </form>
    </div>
    &nbsp;
    <div class="col alert alert-success">
      <h1 class="alert alert-success">Your Records</h1>
      <div class="mt-3">
        <div class="white_shd full margin_bottom_30">
          <table class="table table-dark">
            <thead>
              <tr class="text-warning">
                <th>Name</th>
                <th>Marks</th>
                <th>Course</th>
               
              </tr>
            </thead>
            <tbody id="content" class='text-white'>
             {% for i in list_data %}
             <tr>
              <td>{{i.fname}}</td>
              <td>{{i.marks}}</td>
              <td>{{i.course}}</td>
              <td><form method="post" class="form-inline" >
                {% csrf_token %}
                <button type='submit' class="btn btn-danger" onclick="delete_record(this);" data-sid="${x[i].id}">Delete</button>
                <br><button type='submit' class="btn btn-success" onclick="edit_record(this);" data-sid="${x[i].id}">Edit</button>
                <br><button type='submit' class="btn btn-info" onclick="like(this);" data-sid="${x[i].id}">Like</button>
              </form></td>
              </tr>
             {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"> </script>
    <!-- <script src="{% static 'js/popper.min.js' %}"></script> -->
      <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script>
      document.getElementById('submitBtn').addEventListener('click',function(){
      event.preventDefault();
      fname=document.getElementById('fname').value; 
      sname=document.getElementById('sname').value; 
      email=document.getElementById('email').value; 
      marks=document.getElementById('marks').value; 
      course=document.getElementById('course').value; 
      output='';

      mydata={fname:fname,sname:sname,email:email,marks:marks,course:course};
      $.ajax({
         type:'POST',
         url:'{% url "chat_post" %}',
         data:mydata,
         success:function(response){
           var x=response.list_data;
          for(var i=0;i<x.length;i++){
            output+=`
            <tr>
                <td>${x[i].fname} </td>
                <td>${x[i].marks}</td>
                <td>${x[i].course}</td>
                <td><form method="post" class="form-inline" >
                {% csrf_token %}
                <button type='submit' class="btn btn-danger" onclick="delete_record(this);" data-sid="${x[i].id}">Delete</button>
                <br><button type='submit' class="btn btn-success" onclick="edit_record(this);" data-sid="${x[i].id}">Edit</button>
                <br><button type='submit' class="btn btn-info" onclick="like(this);" data-sid="${x[i].id}">Like</button>

                </form></td>
              </tr>`
              

          }
          $('#form_id').trigger("reset");
          document.getElementById('content').innerHTML=output;
         },
         error:function(){
            
         }
      })
      })
      
     
     //searching by Name
    function search_chat(){
      event.preventDefault();
      var query=$('#search_box').val();
      output='';
      mydata={query:query};
      $.ajax({
        type:"POST",
        url:'{% url "search_by_name" %}',
        data:mydata,
        success:function(response){
        var x=response.data;
        for(var i=0;i<x.length;i++){
          output+=`
          <tr>
            <td>${x[i].fname}</td>
            <td>${x[i].marks}</td>
            <td>${x[i].course}</td>
            <td><form method="post" class="form-inline" >
                {% csrf_token %}
                <button type='submit' class="btn btn-danger" onclick="delete_record(this);" data-sid="${x[i].id}">Delete</button>
                <br><button type='submit' class="btn btn-success" onclick="edit_record(this);" data-sid="${x[i].id}">Edit</button>
                <br><button type='submit' class="btn btn-info" onclick="like(this);" data-sid="${x[i].id}">Like</button>
                </form></td>
            </tr>

          `
          
        }
        document.getElementById('content').innerHTML=output;
        },
        error:function(){
            alert('some error occured during Submit!');
         }
      })
    }

    //deleting the record
    function delete_record(e){
      event.preventDefault();
      mythis=this;
      output='';
      sid=e.getAttribute('data-sid');
      mydata={sid:sid};
      $.ajax({
        type:'POST',
        data:mydata,
        url:'{% url "delete_chat" %}',
        success:function(response){
          var x=response.data;
          // for(var i=0;i<x.length;i++){
          //    output+=`
          //    <tr>
          //   <td>${x[i].fname}</td>
          //   <td>${x[i].marks}</td>
          //   <td>${x[i].course}</td>
          //   </tr>
          //    `
          // }
          // document.getElementById('content').innerHTML=output;
          e.parentNode.parentNode.parentNode.remove();
        },

        error:function(){
          alert('an errror !')
        }
      })
    }

    //editing ercords
    function edit_record(e){
      event.preventDefault();
      sid=e.getAttribute('data-sid');
      mydata={sid:sid};
      $.ajax({
        type:'POST',
        url:'{% url "edit_chat" %}',
        data:mydata,
        success:function(response){
          $('#fname').val(response.fname);
          $('#marks').val(response.marks);
          $('#course').val(response.course);
          $('#sname').val(response.sname);
          $('#email').val(response.email);
          $('#id').val(response.id);
          document.getElementById('buttons').innerHTML=`<button type="submit"  class="btn btn-primary" onclick='update_chat()' id="updateBtn">
            Update
          </button>`;

        },
        error:function(){
          alert('New error ocuured!')
        }
      })
      
    }

    function update_chat(){
      event.preventDefault();
      fname=document.getElementById('fname').value; 
      sname=document.getElementById('sname').value; 
      email=document.getElementById('email').value; 
      marks=document.getElementById('marks').value; 
      course=document.getElementById('course').value; 
      id=document.getElementById('id').value; 
      output='';

      mydata={fname:fname,sname:sname,email:email,marks:marks,course:course,id:id};
      $.ajax({
         type:'POST',
         url:'{% url "update_post" %}',
         data:mydata,
         success:function(response){
         var x=response.list_data;
         for(var i=0;i<x.length;i++){
            output+=`
            <tr>
                <td>${x[i].fname} </td>
                <td>${x[i].marks}</td>
                <td>${x[i].course}</td>
                <td><form method="post" class="form-inline" >
                {% csrf_token %}
                <button type='submit' class="btn btn-danger" onclick="delete_record(this);" data-sid="${x[i].id}">Delete</button>
                <br><button type='submit' class="btn btn-success" onclick="edit_record(this);" data-sid="${x[i].id}">Edit</button>
                <br><button type='submit' class="btn btn-info" onclick="like(this);" data-sid="${x[i].id}">Like</button>

                </form></td>
              </tr>`
          }
          document.getElementById('buttons').innerHTML=`<button type="submit" class="btn btn-primary" id="submitBtn">
            save
          </button>`;
          $('#form_id').trigger("reset");
          document.getElementById('content').innerHTML=output;
          
         },
         error:function(){
            
         }
      })
    }

    $( document ).ready(function() {
      output='';
    $.ajax({
      type:'GET',
      url:'{% url "chat_views" %}',
      success:function(response){
        var x=response.list_data;
        for(var i=0;i<x.length;i++){
            
            output+=`
            <tr>
                <td>${x[i].fname} </td>
                <td>${x[i].marks}</td>
                <td>${x[i].course}</td>
                <td><form method="post" class="form-inline" >
                {% csrf_token %}
                <button type='submit' class="btn btn-danger" onclick="delete_record(this);" data-sid="${x[i].id}">Delete</button>
                <br><button type='submit' class="btn btn-success" onclick="edit_record(this);" data-sid="${x[i].id}">Edit</button>
                <br><button type='submit' class="btn btn-info" onclick="like(this);" data-sid="${x[i].id}">Like</button>
                </form></td>
              </tr>`

              
          }
          
          document.getElementById('content').innerHTML=output;
          
      },
      error:function(){
      
    }
    })
  
    });


    function like(e){
     event.preventDefault();
     id=e.getAttribute('data-sid');
     data={sid:id};
     $.ajax({
       type:'POST',
       url:'{% url "like" %}',
       data:data,
       success:function(response){
        alert('success!')
       },
       error:function(){
         alert('An errror Ocuured!')
       }
     })

     
    }
    </script>
  </html>